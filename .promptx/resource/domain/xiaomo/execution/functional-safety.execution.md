<execution>
  <constraint>
    ## 功能安全约束条件
    - **ISO 26262标准约束**：必须严格遵循ISO 26262-2018版本要求
    - **ASIL等级约束**：根据危害分析结果确定的ASIL等级不可降低
    - **安全生命周期约束**：必须覆盖从概念阶段到报废阶段的完整安全生命周期
    - **验证与确认约束**：安全措施必须通过独立的验证与确认
    - **文档化约束**：所有安全活动必须有完整的文档记录和可审计追踪
  </constraint>

  <rule>
    ## 功能安全强制规则
    - **危害分析必须性**：必须进行完整的HARA危害分析与风险评估
    - **安全目标制定**：每个识别的危害必须制定对应的安全目标
    - **ASIL分解原则**：ASIL分解必须遵循独立性和充分性原则
    - **安全措施验证**：所有安全措施必须通过独立验证
    - **安全案例构建**：必须构建完整的安全案例证明系统安全性
    - **安全管理强制**：必须建立功能安全管理体系和组织架构
  </rule>

  <guideline>
    ## 功能安全指导原则
    - **安全文化建立**：在团队中建立"安全第一"的设计理念
    - **早期安全介入**：在产品概念阶段就开始安全分析和设计
    - **分层安全设计**：从系统级到组件级的分层安全架构设计
    - **持续安全监控**：建立产品全生命周期的安全监控机制
  </guideline>

  <process>
    ## ISO 26262功能安全开发流程

    ### V模型安全开发流程
    ```mermaid
    graph TD
        A[概念阶段] --> B[系统级开发]
        B --> C[硬件级开发]
        B --> D[软件级开发]
        C --> E[硬件集成测试]
        D --> F[软件集成测试]
        E --> G[系统集成测试]
        F --> G
        G --> H[整车集成测试]
        H --> I[生产运行服务]
        
        A --> A1[项目定义<br/>HARA分析<br/>安全目标]
        B --> B1[功能安全概念<br/>技术安全概念<br/>系统设计]
        C --> C1[硬件安全要求<br/>硬件设计<br/>硬件验证]
        D --> D1[软件安全要求<br/>软件设计<br/>软件验证]
    ```

    ### 阶段1：概念阶段 (ISO 26262-3)
    ```mermaid
    flowchart TD
        A[项目启动] --> B[项目定义]
        B --> C[项目安全规划]
        C --> D[危害分析与风险评估HARA]
        D --> E[功能安全目标制定]
        E --> F[概念阶段评审]
        
        D --> D1[使用场景分析]
        D --> D2[危害识别]
        D --> D3[风险评估S×E×C]
        D --> D4[ASIL确定]
        
        E --> E1[安全目标定义]
        E --> E2[安全状态定义]
        E --> E3[故障容错时间]
    ```
    
    **智能驾驶域控HARA分析示例：**
    
    | 功能 | 潜在危害 | 运行情况 | S | E | C | ASIL |
    |------|----------|----------|---|---|---|------|
    | 自动紧急制动 | 意外制动 | 高速行驶 | S3 | E4 | C2 | D |
    | 车道保持辅助 | 意外转向 | 弯道行驶 | S3 | E3 | C2 | C |
    | 自适应巡航 | 加速失效 | 跟车行驶 | S2 | E4 | C3 | B |

    ### 阶段2：系统级开发 (ISO 26262-4)
    ```mermaid
    graph TB
        A[功能安全概念开发] --> B[技术安全概念开发]
        B --> C[系统设计开发]
        C --> D[安全分析]
        D --> E[系统级验证]
        
        A --> A1[功能安全要求分配]
        A --> A2[安全措施定义]
        A --> A3[故障检测机制]
        
        B --> B1[安全架构设计]
        B --> B2[技术安全要求]
        B --> B3[硬软件接口]
        
        C --> C1[系统架构细化]
        C --> C2[安全要求分配]
        C --> C3[接口规范]
        
        D --> D1[FMEA分析]
        D --> D2[FTA分析]
        D --> D3[DFA分析]
        
        E --> E1[安全要求验证]
        E --> E2[安全目标验证]
    ```

    ### 阶段3：硬件级开发 (ISO 26262-5)
    ```mermaid
    flowchart TD
        A[硬件安全要求规范] --> B[硬件安全设计]
        B --> C[硬件架构设计]
        C --> D[硬件详细设计]
        D --> E[硬件实现]
        E --> F[硬件集成测试]
        F --> G[硬件安全验证]
        
        B --> B1[安全机制设计]
        B --> B2[诊断覆盖率分析]
        B --> B3[随机硬件失效分析]
        
        D --> D1[器件选型]
        D --> D2[电路设计]
        D --> D3[PCB设计]
        
        G --> G1[故障注入测试]
        G --> G2[安全机制验证]
        G --> G3[随机失效验证]
    ```
    
    **硬件安全设计关键要素：**
    - **冗余设计**：关键功能双核心锁步执行
    - **多样性设计**：不同架构的备份系统
    - **故障检测**：内置自检BIST、看门狗、ECC
    - **故障处理**：安全状态转换、降级模式

    ### 阶段4：软件级开发 (ISO 26262-6)
    ```mermaid
    graph TD
        A[软件安全要求规范] --> B[软件架构设计]
        B --> C[软件单元设计实现]
        C --> D[软件单元测试]
        D --> E[软件集成测试]
        E --> F[软件安全验证]
        
        B --> B1[软件架构安全分析]
        B --> B2[安全机制设计]
        B --> B3[自由度分析]
        
        C --> C1[编码标准遵循]
        C --> C2[静态分析]
        C --> C3[动态测试]
        
        F --> F1[需求覆盖测试]
        F --> F2[结构覆盖测试]
        F --> F3[故障注入测试]
    ```

    ### 智能驾驶域控安全机制设计
    ```mermaid
    mindmap
      root((安全机制))
        硬件安全机制
          双核锁步执行
          内存保护MPU
          时钟监控CWD
          电压监控LVD
          温度监控TM
        软件安全机制
          程序流监控
          变量范围检查
          时间监控
          数据一致性检查
          算法多样性
        系统安全机制
          故障检测诊断
          安全状态管理
          降级模式控制
          外部监控WDG
          故障记录存储
    ```

    ## 域控制器功能安全架构
    ```mermaid
    graph TB
        subgraph 应用层
        A1[ADAS应用] 
        A2[自动驾驶应用]
        A3[安全监控应用]
        end
        
        subgraph 中间件层
        B1[功能安全中间件]
        B2[通信中间件]
        B3[诊断中间件]
        end
        
        subgraph 操作系统层
        C1[安全OS分区]
        C2[非安全OS分区]
        C3[Hypervisor]
        end
        
        subgraph 硬件层
        D1[主控芯片ASIL-D]
        D2[协处理器ASIL-B]
        D3[安全MCU]
        end
        
        A1 --> B1
        A2 --> B1
        A3 --> B1
        B1 --> C1
        B2 --> C2
        B3 --> C3
        C1 --> D1
        C2 --> D2
        C3 --> D3
    ```
  </process>

  <criteria>
    ## 功能安全评价标准

    ### 安全过程执行质量
    - ✅ **过程完整性**：ISO 26262要求的所有过程100%执行
    - ✅ **文档完整性**：安全工作产品完整性≥95%
    - ✅ **追溯性完整**：安全要求追溯完整性≥98%
    - ✅ **独立性确认**：独立验证与确认覆盖率≥90%

    ### 危害分析质量
    - ✅ **危害识别完整性**：识别的危害覆盖率≥95%
    - ✅ **风险评估准确性**：ASIL评级准确率≥98%
    - ✅ **安全目标充分性**：安全目标对危害覆盖率=100%
    - ✅ **运行情况分析**：使用场景分析完整性≥95%

    ### 安全设计质量
    - ✅ **安全机制覆盖率**：安全要求的安全机制覆盖率≥98%
    - ✅ **诊断覆盖率**：ASIL-D≥99%, ASIL-C≥97%, ASIL-B≥90%
    - ✅ **单点故障指标**：SPFM满足ASIL等级要求
    - ✅ **潜在故障指标**：LFM满足ASIL等级要求

    ### 安全验证质量
    - ✅ **测试覆盖率**：安全要求测试覆盖率≥98%
    - ✅ **故障注入覆盖**：故障注入测试覆盖率≥95%
    - ✅ **安全案例完整性**：安全论证完整性≥95%
    - ✅ **第三方评估**：独立安全评估通过率≥95%
  </criteria>
</execution>
